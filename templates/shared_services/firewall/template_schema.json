{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://github.com/microsoft/AzureTRE/templates/shared_services/firewall/template_schema.json",
  "type": "object",
  "title": "Firewall Shared Service",
  "description": "Provides Firewall shared service",
  "required": [],
  "properties": {
    "rule_collections": {
			"$id": "#root/rule_collections",
			"title": "Rule_collections",
			"type": "array",
			"default": [],
      "updateable": true,
			"items":{
				"$id": "#root/rule_collections/items",
				"title": "items",
				"type": "object",
				"required": [
					"name",
					"priority",
					"action",
					"rules"
				],
				"properties": {
					"name": {
						"$id": "#root/rule_collections/items/name",
						"title": "name",
						"type": "string",
						"examples": [
							"my-rule"
						],
						"pattern": "^.*$"
					},
					"priority": {
						"$id": "#root/rule_collections/items/priority",
						"title": "priority",
						"type": "integer",
						"examples": [
							110
						]
					},
					"action": {
						"$id": "#root/rule_collections/items/action",
						"title": "action",
						"type": "string",
						"examples": [
							"Allow"
						],
            "enum": [
              "Allow",
              "Deny"
            ]
          },
					"rules": {
						"$id": "#root/rule_collections/items/rules",
						"title": "rules",
						"type": "array",
						"default": [],
						"items":{
							"$id": "#root/rule_collections/items/rules/items",
							"title": "Items",
							"type": "object",
							"required": [
								"name"
							],
							"properties": {
								"name": {
									"$id": "#root/rule_collections/items/rules/items/name",
									"title": "name",
									"type": "string",
									"examples": [
										"rule 1"
									],
									"pattern": "^.*$"
								},
								"description": {
									"$id": "#root/rule_collections/items/rules/items/description",
									"title": "description",
									"type": "string",
									"default": "",
									"examples": [
										"My rule description here"
									],
									"pattern": "^.*$"
								},
								"protocols": {
									"$id": "#root/rule_collections/items/rules/items/protocols",
									"title": "protocols",
									"type": "array",
									"default": [],
									"items":{
										"$id": "#root/rule_collections/items/rules/items/protocols/items",
										"title": "Items",
										"type": "object",
										"required": [
											"port",
											"type"
										],
										"properties": {
											"port": {
												"$id": "#root/rule_collections/items/rules/items/protocols/items/port",
												"title": "port",
												"type": "string",
												"examples": [
													"1234"
												],
												"pattern": "^.*$"
											},
											"type": {
												"$id": "#root/rule_collections/items/rules/items/protocols/items/type",
												"title": "type",
												"type": "string",
                        "enum": [
                          "Http",
                          "Https",
                          "Mssql"
                        ],
												"examples": [
													"Http"
												]
											}
										}
									}
								},
                "fqdn_tags": {
									"$id": "#root/rule_collections/items/rules/items/fqdn_tags",
									"title": "fqdn_tags",
									"type": "array",
									"default": [],
									"items":{
										"$id": "#root/rule_collections/items/rules/items/fqdn_tags/items",
										"title": "Items",
										"type": "string",
										"default": "",
                    "enum":[
                      "AppServiceEnvironment",
                      "AzureBackup",
                      "AzureKubernetesService",
                      "HDInsight",
                      "MicrosoftActiveProtectionService",
                      "WindowsDiagnostics",
                      "WindowsUpdate",
                      "WindowsVirtualDesktop"
                    ],
										"examples": [
											"AzureKubernetesService"
										]
									}
								},
								"target_fqdns": {
									"$id": "#root/rule_collections/items/rules/items/target_fqdns",
									"title": "target_fqdns",
									"type": "array",
									"default": [],
									"items":{
										"$id": "#root/rule_collections/items/rules/items/target_fqdns/items",
										"title": "Items",
										"type": "string",
										"default": "",
										"examples": [
											"one.two.three.com"
										]
									}
								},
								"source_addresses": {
									"$id": "#root/rule_collections/items/rules/items/source_addresses",
									"title": "Source_addresses",
									"type": "array",
									"default": [],
									"items":{
										"$id": "#root/rule_collections/items/rules/items/source_addresses/items",
										"title": "Items",
										"type": "string",
										"default": "",
										"examples": [
											"172.196.0.0"
										]
									}
								}
							}
						}
					}
				}
			}
    }
  }
}
